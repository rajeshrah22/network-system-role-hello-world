# Anisble network linux system role hello world

## My introduction into Linux-system-role.network for Ansible

Linux-system-roles is a group of Ansible roles to make automated system administration tasks easier.

### Install ansible

```bash
dnf install ansible -y
```

### Install from Ansible Galaxy

```bash
ansible-galaxy install linux-system-roles.network
```

### Run playbooks

- First, configure the inventory.yml with your hosts.
- Then, configure the playbooks with the right nsmtate states
  in the `network_state` variable.
  Example: make sure the DHCP server is configured correctly. Make sure next-hop is configured correctly.
- Then run `ansible-playbook`. This is the initial DHCP configuration.

```bash
ansible-playbook \
-i inventory.yml \
hello-nmstate-dhcp.yml \
-u <remote-user> --ask-become-pass -b
```

- You can then run `verify-nmstate.yml` the same way.

Example output:

```
$ ansible-playbook -i inventory.yml  hello-nmstate-dhcp.yml -u rahulrajesh --ask-become-pass -b 
BECOME password: 

PLAY [Hello World - nmstate DHCP Configuration] ********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
[WARNING]: Platform linux on host target-server is using the discovered Python interpreter at /usr/bin/python3.13, but future installation of another Python interpreter could change the meaning of that path. See https://docs.ansible.com/ansible-core/2.18/reference_appendices/interpreter_discovery.html for more information.
ok: [target-server]

TASK [Apply DHCP network configuration using nmstate] **************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
included: linux-system-roles.network for target-server

TASK [linux-system-roles.network : Ensure ansible_facts used by role] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
included: /home/rrajesh/.ansible/roles/linux-system-roles.network/tasks/set_facts.yml for target-server

TASK [linux-system-roles.network : Ensure ansible_facts used by role are present] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Check if system is ostree] ******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [linux-system-roles.network : Set flag to indicate system is ostree] ******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [linux-system-roles.network : Check which services are running] ***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [linux-system-roles.network : Check which packages are installed] *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [linux-system-roles.network : Print network provider] *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server] => {
    "msg": "Using network provider: nm"
}

TASK [linux-system-roles.network : Abort applying the network state configuration if using the `network_state` variable with the initscripts provider] *************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Abort applying the network state configuration if the system version of the managed host is below 8] ****************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Abort applying teaming configuration if the system version of the managed host is EL10 or later] ********************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Check if updates for network packages are available through the DNF package manager due to wireless or team interfaces] *********************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Check if updates for network packages are available through the YUM package manager due to wireless or team interfaces] *********************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Ask user's consent to restart NetworkManager due to wireless or team interfaces] ************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Install packages] ***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Install NetworkManager and nmstate when using network_state variable] ***********************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [linux-system-roles.network : Install python3-libnmstate when using network_state variable] *******************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [linux-system-roles.network : Restart NetworkManager due to wireless or team interfaces] **********************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Enable and start NetworkManager] ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [linux-system-roles.network : Enable and start wpa_supplicant] ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Enable network service] *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Ensure initscripts network file dependency is present] **************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Configure networking connection profiles] ***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [linux-system-roles.network : Configure networking state] *****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [linux-system-roles.network : Show stderr messages for the network_connections] *******************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server] => {
    "__network_connections_result.stderr_lines": [
        ""
    ]
}

TASK [linux-system-roles.network : Show debug messages for the network_connections] ********************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Show debug messages for the network_state] **************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
skipping: [target-server]

TASK [linux-system-roles.network : Re-test connectivity] ***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server]

TASK [Show network status] *****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
changed: [target-server]

TASK [Display network configuration] *******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
ok: [target-server] => {
    "network_status.stdout_lines": [
        "GENERAL.DEVICE:                         enp1s0",
        "GENERAL.TYPE:                           ethernet",
        "GENERAL.HWADDR:                         52:54:00:1C:BC:66",
        "GENERAL.MTU:                            7000",
        "GENERAL.STATE:                          100 (connected)",
        "GENERAL.CONNECTION:                     enp1s0",
        "GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/ActiveConnection/2",
        "WIRED-PROPERTIES.CARRIER:               on",
        "IP4.ADDRESS[1]:                         192.168.122.194/24",
        "IP4.GATEWAY:                            192.168.122.1",
        "IP4.ROUTE[1]:                           dst = 192.168.122.0/24, nh = 0.0.0.0, mt = 100",
        "IP4.ROUTE[2]:                           dst = 0.0.0.0/0, nh = 192.168.122.1, mt = 100",
        "IP4.DNS[1]:                             192.168.122.1",
        "IP4.DOMAIN[1]:                          rrajesh-na.ibmlowe.csb",
        "IP4.SEARCHES[1]:                        rrajesh-na.ibmlowe.csb",
        "IP6.ADDRESS[1]:                         fe80::5054:ff:fe1c:bc66/64",
        "IP6.GATEWAY:                            --",
        "IP6.ROUTE[1]:                           dst = fe80::/64, nh = ::, mt = 1024"
    ]
}

PLAY RECAP *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
target-server              : ok=17   changed=1    unreachable=0    failed=0    skipped=14   rescued=0    ignored=0
```
